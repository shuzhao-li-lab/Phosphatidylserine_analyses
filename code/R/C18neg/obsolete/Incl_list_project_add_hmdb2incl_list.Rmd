---
title: "Add hmdb tentative annotation into the inclusion list to supplement more information"
output: html_notebook
---
- This notebook is created after `Merge filtered features with mcg output to supplement information`
- purpose: to further decrease the list by adding the hmdb matching result to filter out results that cannot match to any features that cannot be matched with abundant adducts.

## Clean up the environment and load the library 

```{r, include=FALSE}
rm(list = ls())

library(xcms)
library(RColorBrewer)
library(pander)
library(magrittr)
library(pheatmap)
library(SummarizedExperiment)
library(dplyr)
library(tidyr)
library(ggpubr)
library(ggplot2)
```


# Read the tables and set the output directory

```{r}
main_df <- read.csv("../../data/output/RPneg_0331analysis/incl_list_merge_filt_mcg/inclusion_l_mcg_merged.csv", header = 1)

hmdb_df <- read.csv("../../data/output/RPneg_0331analysis/hmdb_search_res/hmdb_match_result_padj05filt_RPneg.csv", header = 1)
  
output_dir <- "../../data/output/RPneg_0331analysis/incl_list_merge_wt_hmdb/"
dir.create(output_dir)
```

## Check the input table
```{r}
main_df[1:5,1:5]
hmdb_df[1:5,1:5]
```

## collapse the hmdb result table with `query_mass` as ID.

```{r}
col_hmdb_df <-  hmdb_df %>% 
  group_by(query_mass) %>% 
  summarise_each(funs(paste(., collapse = ";")))
```

## Correct the issue with different rounding of the number
```{r}
round(col_hmdb_df$query_mass,4) %in% round(main_df$mzmed,4)
```

## merge the `col_hmdb_df` with the `main_df`

```{r}
col_hmdb_df$round_mz <- round(col_hmdb_df$query_mass,4)
main_df$round_mz <- round(main_df$mzmed,4)
m_df <- merge(main_df,col_hmdb_df,by = "round_mz", all.x = TRUE)
```

## write the table
```{r}
write.csv(m_df,paste0(output_dir,"merged_hmdb_mcg_fit_inclusion_list.csv") , row.names = FALSE)
```

